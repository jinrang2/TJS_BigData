CREATE TABLE CUSTOMERS (
    USER_ID         VARCHAR2(30),
    USER_NAME       VARCHAR2(30) NOT NULL,
    USER_PHONE      VARCHAR2(255) NOT NULL,
    EMAIL           VARCHAR2(40),
    CONSTRAINT PK_CUSTOMERS PRIMARY KEY (USER_ID),
    CONSTRAINT UQ_CUSTOMERS01 UNIQUE (USER_PHONE)   
);

CREATE TABLE CUSTOMERS_DST (
    DST_NO          NUMBER(10),
    USER_ID         VARCHAR2(30) NOT NULL,
    DST_NAME        VARCHAR2(30) NOT NULL,
    DST_HUMAN_NAME  VARCHAR2(30) NOT NULL,
    DST_ADDRESS     VARCHAR2(255) NOT NULL,
    DST_PHONE       VARCHAR2(30) NOT NULL,
    DST_DEFAULT     VARCHAR2(1),
    CONSTRAINT PK_CUSTOMERS_DST PRIMARY KEY (DST_NO),
    CONSTRAINT UQ_CUSTOMERS_DST01 UNIQUE (USER_ID, DST_NAME),
    CONSTRAINT FK_CUSTOMERS_DST_USER_ID FOREIGN KEY (USER_ID) 
    REFERENCES CUSTOMERS(USER_ID)
);


CREATE TABLE GOODS (
    GOODS_CODE      VARCHAR2(30) NOT NULL,
    GOODS_NAME      VARCHAR2(200) NOT NULL,
    PRICE           NUMBER(10) NOT NULL,
    CONSTRAINT PK_GOODS PRIMARY KEY (GOODS_CODE),
    CONSTRAINT CHK_GOODS_PRICE CHECK (PRICE > 0)
);

COMMENT ON TABLE GOODS IS '상품 테이블, 상품의 단가가 바뀌면 새로운 상품번호를 부여하기로 한다';

CREATE TABLE BASKET(
    BASKET_NO      VARCHAR2(20) NOT NULL,
    USER_ID        VARCHAR2(30) NOT NULL,
    GOODS_CODE     VARCHAR2(30) NOT NULL,
    GOODS_COUNT    NUMBER(4) NOT NULL,
    CONSTRAINT FK_BASKET_USER_ID FOREIGN KEY (USER_ID) 
    REFERENCES CUSTOMERS(USER_ID),
    CONSTRAINT FK_BASKET_GOODS_CODE FOREIGN KEY (GOODS_CODE) 
    REFERENCES GOODS(GOODS_CODE)
);

CREATE TABLE ORDERS (
    ORDER_NO        VARCHAR2(20),
    ORDER_DATE      DATE DEFAULT SYSDATE NOT NULL,
    USER_ID         VARCHAR2(30),
    DST_NO          NUMBER(10),
    CONSTRAINT PK_ORDERS PRIMARY KEY (ORDER_NO),
    CONSTRAINT FK_ORDERS_USER_ID FOREIGN KEY (USER_ID) 
    REFERENCES CUSTOMERS(USER_ID),
    CONSTRAINT FK_ORDERS_DST_NO FOREIGN KEY (DST_NO) 
    REFERENCES CUSTOMERS_DST(DST_NO)
);

CREATE TABLE ORDERS_GOODS (
    ORDER_NO        VARCHAR2(20) NOT NULL,
    GOODS_CODE      VARCHAR2(30) NOT NULL,
    COUNT           NUMBER(4) NOT NULL,
    CONSTRAINT PK_ORDERS_GOODS PRIMARY KEY (ORDER_NO, GOODS_CODE),
    CONSTRAINT FK_ORDERS_GOODS_ORDER_NO FOREIGN KEY (ORDER_NO)
    REFERENCES ORDERS(ORDER_NO),
    CONSTRAINT FK_ORDERS_GOODS_GOODS_CODE FOREIGN KEY (GOODS_CODE)
    REFERENCES GOODS(GOODS_CODE)
);


